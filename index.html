<!DOCTYPE html>
<html>
    <head>
     <title>sahnyooktalk</title>
     <meta charset="utf-8">
    <meta name="description" content="서울삼육중학교 대화 웹사이트입니다">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      /* Mobile-first responsive styles */
      :root{--primary:#7844e8;--muted:#f6f6fb;--dark:#2e2e2e}
      html,body{height:100%;}
      body.site-body{font-family:Poppins, 'Noto Sans KR', sans-serif; margin:0; background:#fff; color:var(--dark); -webkit-font-smoothing:antialiased}
      .hero{background-color:#703fda;color:#fff;text-align:center;padding:18px}
      .hero h1{color:#fff;font-weight:300;margin:0;font-size:20px}
      .hero p{margin-top:8px}
      .container{max-width:560px;margin:24px auto;padding:0 16px;box-sizing:border-box}
      .card{background:var(--muted);padding:18px;border-radius:8px}
      img.responsive{width:100%;height:auto;display:block;border-radius:6px}
      .comment-form input,.comment-form textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-family:inherit}
      .btn{display:inline-block;padding:12px 16px;background:var(--primary);color:#fff;border-radius:6px;border:none;cursor:pointer;font-weight:600}
      #commentsList .comment{background:#fff;padding:12px;border-radius:6px;margin-bottom:12px;border-left:4px solid var(--primary)}
      /* 강제 순서 고정용 래퍼 */
      .stack{display:flex;flex-direction:column}
      .stack .block-comments{order:1}
      .stack .block-form{order:2}
      /* Admin modal adjustments */
      #adminModal .modal-inner{width:92%;max-width:600px;margin:40px auto;padding:20px}
      @media(min-width:720px){
        .hero h1{font-size:28px}
        .container{padding:0}
        #adminModal .modal-inner{padding:30px}
      }
    </style>
    <meta property="og:title" content="ParkSeoJoon">
     <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&family=Poppins&display=swap" rel="stylesheet">
     </head>
    <body class="site-body">
     <div class="hero">

      <h1>이름과 함께 당신의 의견을 제출해주세요</h1>
      <p>
        <span style="font-weight:700;">비공식 삼육중학교 대화수단입니다</span>

      </p>
    </div>
    <div class="container">
      
      <h2 style="color: #2e2e2e; font-size: 20px">
        <br>
        
      </h2>
      <img class="responsive" src="http://image.toast.com/aaaaaaq/iamschool/test/LOGO_IMAGE/170337890708924164.PNG">
      <p>
    
           </p>      <p style="text-align: center;">        <a href="https://www.youtube.com/shorts/YEhDlkBl_D0" style="font-size: 32px; display: inline-block;">
          ㅊㅇㅅTlqkftoRl
        </a>
      </p>
     </div>
      <div class="stack" id="commentsSection">
        <div class="block-comments" style="margin-top:30px;">
          <h3 style="color:#2e2e2e">댓글 목록</h3>
          <div id="commentsList"></div>
        </div>
        <div class="card block-form" style="margin-top:30px;">
          <h3 style="color: #2e2e2e;">코멘트를 남겨주세요</h3>
          <form id="commentForm" class="comment-form" style="display:flex;flex-direction:column;gap:12px;">
            <input type="text" id="name" placeholder="이름" required>
            <textarea id="content" placeholder="코멘트를 입력하세요" required style="min-height:110px;resize:vertical"></textarea>
            <button type="submit" class="btn">제출</button>
          </form>
          <div id="message" style="margin-top: 10px; color: #7844e8;"></div>
        </div>
      </div>
    <!-- 상단 중복 문구 제거됨 -->
        <script>
        (function(){
          const API_BASE = 'https://asdf-1-9s27.onrender.com';
          const form = document.getElementById('commentForm');
          const nameInput = document.getElementById('name');
          const contentInput = document.getElementById('content');
          const messageDiv = document.getElementById('message');
          const commentsList = document.getElementById('commentsList');

          let adminPassword = '';
          let isAdmin = false;

          function showAlert(msg){
            messageDiv.textContent = msg;
            messageDiv.style.color = '#7844e8';
            setTimeout(()=> messageDiv.textContent = '', 3000);
          }

          // 관리자 기능 제거됨 (서버에서 관련 엔드포인트 제거됨)

          // 댓글 로드 (응답이 JSON이 아닐 때 친절하게 처리)
          async function loadComments(){
            try{
              const res = await fetch(API_BASE + '/api/comments');
              const ct = res.headers.get('content-type') || '';
              if(!res.ok){
                const text = await res.text();
                console.error('댓글 로드 실패:', res.status, text);
                commentsList.innerHTML = '<p style="color:#ff0000;">댓글을 불러올 수 없습니다.</p>';
                return;
              }
              if(!ct.includes('application/json')){
                const text = await res.text();
                console.error('댓글 로드: JSON 아님, 응답:', text.slice(0,200));
                commentsList.innerHTML = '<p style="color:#ff0000;">댓글을 불러올 수 없습니다.</p>';
                return;
              }
              const comments = await res.json();
              commentsList.innerHTML=''; if(!Array.isArray(comments)) return; comments.forEach(c=>{ const div=document.createElement('div'); div.className='comment'; div.setAttribute('data-id', String(c.id)); div.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center;gap:8px"><div><strong style="color:#7844e8">${escapeHtml(c.name)}</strong><p style="margin:5px 0;color:#2e2e2e">${escapeHtml(c.content)}</p><small style="color:#999">${escapeHtml(c.date)}</small></div><button class="btn btn-delete" style="background:#e84c44" aria-label="댓글 삭제">삭제</button></div>`; commentsList.appendChild(div); });
              
            }catch(err){ console.error('댓글 로드 오류:',err); commentsList.innerHTML = '<p style="color:#ff0000;">댓글을 불러올 수 없습니다.</p>'; }
          }

          // 폼 제출
          if(form){
            form.addEventListener('submit', async (e)=>{
              e.preventDefault();
              try{
                const res = await fetch(API_BASE + '/api/comments',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:nameInput.value,content:contentInput.value})});
                const ct = res.headers.get('content-type') || '';
                if(!res.ok){
                  const text = await res.text();
                  showAlert('오류: 서버 응답 실패');
                  console.error('댓글 제출 실패:', res.status, text);
                  return;
                }
                if(!ct.includes('application/json')){
                  const text = await res.text();
                  showAlert('오류: 서버가 JSON을 반환하지 않습니다');
                  console.error('댓글 제출: JSON 아님, 응답:', text.slice(0,300));
                  return;
                }
                const data = await res.json();
                if(data.success){ showAlert('댓글이 등록되었습니다!'); nameInput.value=''; contentInput.value=''; await loadComments(); }
                else showAlert(data.message||'오류');
              }catch(err){ showAlert('오류: '+err.message); }
            });
          }

          // 안전한 HTML 이스케이프
          function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]); }

          // 댓글 삭제 핸들러 (위임)
          async function deleteComment(id){
            try{
              const res = await fetch(API_BASE + '/api/comments/' + id, { method: 'DELETE' });
              const ct = res.headers.get('content-type') || '';
              if(!res.ok){
                const text = await res.text();
                showAlert('삭제 실패');
                console.error('댓글 삭제 실패:', res.status, text);
                return;
              }
              if(!ct.includes('application/json')){
                const text = await res.text();
                console.error('댓글 삭제: JSON 아님, 응답:', text.slice(0,300));
              }
              await loadComments();
              showAlert('댓글이 삭제되었습니다');
            }catch(err){
              showAlert('오류: ' + err.message);
            }
          }

          commentsList.addEventListener('click', (e)=>{
            const target = e.target;
            if(target && target.classList && target.classList.contains('btn-delete')){
              const commentEl = target.closest('.comment');
              const idStr = commentEl ? commentEl.getAttribute('data-id') : null;
              const id = idStr ? Number(idStr) : null;
              if(!id) return;
              if(confirm('댓글을 삭제하시겠습니까?')){
                deleteComment(id);
              }
            }
          });

          // 초기 로드
          loadComments();
        })();
        </script>
    </div>
    <div style="background-color: #f6f6fb; width: 550px;margin: 32px;margin: 0 auto">
      
      </p>
    </div>
    <div style="background-color: #7844e8; color: #ffffff;padding: 20px">
      <h2 style="text-align: center;">
        setter 안쓰고 만들었으니까
        이상한 사람들한테 공유하지 말아주세요^^(안그럼 털림)
      </h2>
    </div>
    <div style="background-color: #2e2e2e; color: #ffffff; text-align: center;padding: 50px">
      <p>

        render 도메인 서버를 통해 운영됩니다. ㅣ도배시 서버 접속 막을게요

      </p>
      <p>
       평가하십쇼
      </p>
      <p>
        (주)CheeseBall_United ㅣ 문의:010-5534-7351
      </p>
    </div>
   </body>
</html>
